# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: Update Lotto Data Weekly

# ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¡°ê±´
on:
  # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ë²„íŠ¼ì„ ë§Œë“¦
  workflow_dispatch:
  # ìŠ¤ì¼€ì¤„ì— ë”°ë¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰
  schedule:
    # ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 5ì‹œ (í•œêµ­ ì‹œê°„ ê¸°ì¤€, UTCë¡œëŠ” í† ìš”ì¼ 20ì‹œ)ì— ì‹¤í–‰
    - cron: '0 20 * * SAT'

# ì‹¤í–‰ë  ì‘ì—…(Job) ì •ì˜
jobs:
  update-data:
    # ì‘ì—…ì´ ì‹¤í–‰ë  í™˜ê²½ (Ubuntu ìµœì‹  ë²„ì „)
    runs-on: ubuntu-latest
    
    # ì‘ì—…ì˜ ë‹¨ê³„(Step)ë“¤
    steps:
      # 1. ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ runnerë¡œ ê°€ì ¸ì˜´ (Checkout)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Node.js í™˜ê²½ ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      # 3. npm íŒ¨í‚¤ì§€ ì„¤ì¹˜
      - name: Install dependencies
        run: npm install

      # 4. JavaScript ë‹¤ìš´ë¡œë” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      - name: Run JavaScript Downloader
        run: node download.js

      # 5. âœ… [ì¶”ê°€] ë°ì´í„°ë¥¼ SQL íŒŒì¼ë¡œ ì¶”ì¶œ
      - name: Export data to SQL
        run: node export-sql.js

      # 6. âœ… [ì¶”ê°€] ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ì¶”ì¶œ
      - name: Export data to JSON
        run: node export-json.js

      # 7. ë³€ê²½ëœ ë°ì´í„° íŒŒì¼ë“¤ì„ Gitì— ë‹¤ì‹œ ì»¤ë°‹ ë° í‘¸ì‹œ
      - name: Commit and push if changed
        run: |
          # ë´‡ì˜ ì´ë¦„ê³¼ ì´ë©”ì¼ ì„¤ì •
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          # âœ… [ìˆ˜ì •] ìƒì„±ëœ ëª¨ë“  ë°ì´í„° íŒŒì¼ì„ ìŠ¤í…Œì´ì§•
          git add lotto_data.html lotto_data.sql lotto_data.json
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ê²½ìš°ì—ë§Œ ì»¤ë°‹
          git diff-index --quiet HEAD || git commit -m "ğŸ“Š Lotto data updated automatically"
          # ì €ì¥ì†Œì— í‘¸ì‹œ
          git push